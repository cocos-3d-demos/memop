{"version":3,"file":"memop.dev.js","sources":["../lib/fixed-array.js","../lib/pool.js","../lib/frame-pool.js"],"sourcesContent":["export default class FixedArray {\n  constructor(size) {\n    this._count = 0;\n    this._data = new Array(size);\n  }\n\n  _resize (size) {\n    if (size > this._data.length) {\n      for (let i = this._data.length; i < size; ++i) {\n        this._data[i] = this._fn();\n      }\n    }\n  }\n\n  get length () {\n    return this._count;\n  }\n\n  get data () {\n    return this._data;\n  }\n\n  reset() {\n    for (let i = 0; i < this._count; ++i) {\n      this._data[i] = undefined;\n    }\n\n    this._count = 0;\n  }\n\n  push(val) {\n    if (this._count >= this._data.length) {\n      this._resize(this._data.length * 2);\n    }\n\n    this._data[this._count] = val;\n    ++this._count;\n  }\n\n  pop() {\n    --this._count;\n\n    if (this._count < 0) {\n      this._count = 0;\n    }\n\n    let ret = this._data[this._count];\n    this._data[this._count] = undefined;\n\n    return ret;\n  }\n\n  fastRemove(idx) {\n    if ( idx >= this._count ) {\n      return;\n    }\n\n    let last = this._count-1;\n    this._data[idx] = this._data[last];\n    this._data[last] = undefined;\n    this._count -= 1;\n  }\n}","export default class Pool {\n  constructor(fn, size) {\n    this._fn = fn;\n    this._idx = size-1;\n    this._frees = new Array(size);\n\n    for (let i = 0; i < size; ++i) {\n      this._frees[i] = fn();\n    }\n  }\n\n  _expand (size) {\n    let old = this._frees;\n    this._frees = new Array(size);\n\n    let len = size-old.length;\n    for (let i = 0; i < len; ++i) {\n      this._frees[i] = this._fn();\n    }\n\n    for (let i = len, j=0; i < size; ++i, ++j) {\n      this._frees[i] = old[j];\n    }\n\n    this._idx += len;\n  }\n\n  alloc () {\n    // create some more space (expand by 20%, minimum 1)\n    if (this._idx < 0) {\n      this._expand(Math.round(this._frees.length * 1.2) + 1);\n    }\n\n    return this._frees[this._idx--];\n  }\n\n  free (obj) {\n    ++this._idx;\n    this._frees[this._idx] = obj;\n  }\n}","export default class FramePool {\n  constructor(fn, size) {\n    this._fn = fn;\n    this._count = 0;\n    this._data = new Array(size);\n\n    for (let i = 0; i < size; ++i) {\n      this._data[i] = fn();\n    }\n  }\n\n  _resize (size) {\n    if (size > this._data.length) {\n      for (let i = this._data.length; i < size; ++i) {\n        this._data[i] = this._fn();\n      }\n    }\n  }\n\n  alloc () {\n    if (this._count >= this._data.length) {\n      this._resize(this._data.length * 2);\n    }\n    return this._data[this._count++];\n  }\n\n  reset () {\n    this._count = 0;\n  }\n}"],"names":[],"mappings":"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"}